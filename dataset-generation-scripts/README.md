> ⚠️ **Heads-up!**  
This section is only useful for the repository maintainers. Feel free to ignore this section if you are just looking for the Vietnamese Database Dataset.

# Vietnames Provinces Database Dataset Automation Scripts

Vietnamese Government will gradually issue new decree to make change to the administrative units. The change is vary: promoting ward to a higher administrative unit, merging ward, etc...  
Therefore, it's challenging to keep the dataset up-to-date. Before the development of this automation scripts, I have to manually read the decree change and compare it with the new xls sheet (which is kind of dumb and counter-productive way 🙈)  
Then it finally come to the development of this autogenerated patch script to make this repository maintainers's life easy.

## How does it work
[![image.png](https://i.postimg.cc/BnY9f29C/image.png)](https://postimg.cc/dhyS8k07)

The scripts are divided into two main phrases

- `dumper.go`: Read the administrative data from the GSO SOAP API, perform data transformation and insert the records into a temporary Postgres database  
- `patch_writer.go`: Read from the persisted temporary Postgres database, and generate insert records scripts for all different kinds of databases (MySQL/Postgres, SQL Server and Oracle), and NoSQL
## How to run
### Prerequisite
You must have these thing installed on your machine
- Postgresql
- Go
### Setting thing up
#### Postgres temporary database 
You will need to create a temporary database in Postgres named `vn_provinces_tmp` in your local Postgres. And provide the access credential in the connection string in `common/postgres_connector.go`
```golang
func GetPostgresDBConnection() *bun.DB {
	dsn := "postgres://postgres:root@localhost:5432/vn_provinces_tmp?sslmode=disable"
	sqlDB := sql.OpenDB(pgdriver.NewConnector(pgdriver.WithDSN(dsn)))
	db := bun.NewDB(sqlDB, pgdialect.New())
	return db
}
```

#### Git LFS
⚠️ This project uses [Git LFS](https://git-lfs.github.com/) for large GIS dataset files.  
Make sure to run:
```shell
git lfs install
git lfs pull
```
before running the project.

#### Executing
At the root of the `dataset-generation-scripts` folder, run
```shell
go run main.go
```
And check the result in the `output` folder. The final result is three SQL patches will be generated for three type of databases (due to their difference in syntax).

# Run testcase
> go test -v ./...
